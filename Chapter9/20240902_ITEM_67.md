# 최적화는 신중히 하라

최적화는 섣불리 진행하면 해로운 결과로 이어지기 쉽고, 빠르지도 않고, 제대로 동작하지 않으면서 수정하기는 어려운 소프트웨어를 만들어낼 수도 있다.

### 빠른 프로그램보다는 좋은(정보 은닉이 잘 지켜진) 프로그램을 작성하라

- 좋은 프로그램이라면 성능이 나오지 않을때, 아키텍쳐 자체가 최적화할 수 있는 길을 안내해줄 것이다.
- 정보 은닉 덕분에 개별 구성요소에서 독립적으로 다시 설계할 수 있다.
- 성능을 위해 완성된 설계의 기본 틀을 변경하려면 매우 어려우므로 설계 단계에서 성능을 반드시 염두에 두어야 한다.

### 성능을 제한하는 설계를 피하라

- 완성 후 가장 변경하기가 어려운 설계 요소는 컴포넌트끼리, 혹은 외부 시스템과의 소통 방식이다.
    - API, 네트워크 프로토콜, 영구 저장용 데이터 포맷 등
- 그러므로 설계 단계에서 시스템 성능을 제한하는 설계를 해선 안된다.

### API를 설계할 때 성능에 주는 영향을 고려하라

- public 타입을 가변으로 만들면 불필요한 방어적 복사를 유발할 수 있다.
    - 예: `java.awt.Dimension`은 가변으로 설계되었기 때문에 매번 방어적 복사를 해야 한다.
- 컴포지션으로 해결할 수 있음에도 상속으로 설계한 public클래스는 상위 클래스에 영원히 종속되며 성능제약까지도 물려받는다.
- 인터페이스가 아닌 구현 타입을 사용하면 특정 구현체에 종속되고, 나중에 더 빠른 구현체가 나오더라도 사용할 수 없다.

### 잘 설계된 API는 성능도 좋은게 보통이므로, 성능을 위해 API를 왜곡하지 마라

- API를 왜곡하도록 만든 그 성능문제는 해당 플랫폼이나 아랫단 소프트웨어의 다음 버전에서 사라질 수 있다.
- 하지만 왜곡된 API와 이를 지원하는데 따르는 고통은 영원할 것이다.

### 최적화 시도 전후로 성능을 측정하라

- 최적화 후에 성능이 크게 좋아지지 않거나 오히려 나빠질 수도 있다.
- 프로파일링 도구를 통해 최적화 노력을 어디에 집중해야 할지 찾을 수 있다.

### 정리

빠른 프로그램을 작성하려 안달하지 말자. 좋은 프로그램을 작성하다 보면 성능은 따라오기 마련이다.

하지만 시스템을 설계할 때, 특히 API, 네트워크 프로토콜, 영구 저장용 데이터 포맷을 설계할 때는 성능을 염두에 두어야 한다. 시스템 구현을 완료했다면 이제 성능을 측정해보라. 충분히 빠르면 그것으로 끝이다.

그렇지 않다면 프로파일러를 사용해 문제의 원인이 되는 지점을 찾아 최적화를 수행하라.

가장 먼저 어떤 알고리즘을 사용했는지를 살펴보자. 알고리즘을 잘못 골랐다면 다른 저수준 최적화는 아무리 해봐야 소용이 없다. 

만족할 때까지 이 과정을 반복하고, 모든 변경 후에는 성능을 측정하라.
