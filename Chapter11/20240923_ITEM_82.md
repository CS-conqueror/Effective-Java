# 스레드 안정성 수준을 문서화하라

> 스레드 안정성을 수준에 따라 자세하게 문서화해서 클라이언트가 적절히 사용하도록 하자

<br>

## Synchronized 한정자로는 부족하다

---

- 자바독 기본 속성 API 문서에는 synchronized 한정자가 포함되지 않음
- 스레드 안정성 수준은 다양함

<br>

## 스레드 안정성 수준

---

### 불변(@Immutable)

<br>

> 이 클래스의 인스턴스는 상수와 같아서 외부 동기화가 필요 없음

<br>

### 무조건적 스레드 안전(@ThreadSafe)

<br>

> 이 클래스는 수정될 수 있으나 내부 동기화가 충실하여 외부 동기화가 필요 없음

- 외부에서 사용할 수 있는 락 제공 시 내부의 동시성 제어 메커니즘과 혼용 불가
- 비공개 락 : 클래스의 비공개 필드를 락으로 사용, 무조건적 스레드 안전에서만 사용(외부 공개 X)
  * 공개된 락(synchronized)의 서비스 거부 공격을 예방
  * final로 사용하여 변경 가능성을 최소화 하길 권장
  * 상속에서 유리 : 부모, 자식 클래스 간 동기화 충돌 방지 + 동기화 정책 분리 가능
     
```java
public class PrivateLockExample {
    private final Object lock = new Object();  // 비공개 락 객체

    public void someMethod() {
        synchronized (lock) {  // 비공개 락 객체를 사용하여 동기화
            // 동기화된 코드
        }
    }
}
```

<br>

### 조건부 스레드 안전(@ThreadSafe)

<br>

> 이 클래스는 수정될 수 있고 내부 동기화도 충실하지만 일부 메서드는 외부 동기화가 필요

- 어떤 순서로 호출할 때 외부 동기화가 필요한지, 어떤 락을 얻어야 하는지 등 자세히 작성

<br>

### 스레드 안전하지 않음(@NotThreadSafe)

<br>

> 이 클래스는 수정될 수 있고 동시에 사용하려면 외부 동기화가 필요

<br>

### 스레드 적대적

<br>

> 이 클래스는 외부 동기화를 하더라도 스레드 안전하지 않음

- 정적 데이터를 아무 동기화 없이 수정
- 문제를 고쳐서 재배포하거나 사용 자제를 API로 지정
